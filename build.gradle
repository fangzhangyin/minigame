// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN

buildscript {
    repositories {
        mavenCentral()
        google()
        jcenter()
        // 配置HUAWEI Ads SDK的Maven仓地址
        maven { url 'https://developer.huawei.com/repo/' }
    }

    dependencies {
        classpath 'com.android.tools.build:gradle:4.2.2'
        classpath 'com.huawei.agconnect:agcp:1.6.0.300'
    }
}

allprojects {
    repositories {
        mavenCentral()
        google()
        // 配置HUAWEI Ads SDK的Maven仓地址
        maven { url 'https://developer.huawei.com/repo/' }
        jcenter()
        flatDir {
            dirs 'libs'
        }
    }
}

apply plugin: 'com.android.application'


//dependencies {
//    implementation fileTree(dir: 'libs', include: ['*.jar'])
//}

android {
    compileSdkVersion 30
    buildToolsVersion '30.0.2'

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    defaultConfig {
        minSdkVersion 21
        targetSdkVersion 30
        applicationId 'com.hzklt.minigame'
        ndk {
            abiFilters 'armeabi-v7a'
        }
        versionCode 1
        versionName '0.1'
    }

    lintOptions {
        abortOnError false
    }

    aaptOptions {
        noCompress = ['.unity3d', '.ress', '.resource', '.obb']
    }

    //签名文件配置要在一些配置之前
    signingConfigs {
        debug {
            storeFile file('E:\\mini-game\\tempProject\\keystore\\sign1.jks')
            keyAlias 'klt2021'
            keyPassword 'klt2021'
            storePassword 'klt2021'
        }
        release {
            //storeFile file('E:/LayaSVN2/Unity3D/hdcjtest/androidBuild/user.keystore')
            storeFile file('E:\\mini-game\\tempProject\\keystore\\sign1.jks')
            storePassword 'klt2021'
            keyAlias 'klt2021'
            keyPassword 'klt2021'
        }
        release {
            v1SigningEnabled true
            v2SigningEnabled true
        }
    }

    //编译类型配置默认不动
    buildTypes {
        debug {
            minifyEnabled false    //启用代码混淆
            useProguard false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-unity.txt'
            jniDebuggable true
        }
        release {
            minifyEnabled false
            useProguard false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-unity.txt'
            signingConfig signingConfigs.release
        }
    }

    packagingOptions {
        doNotStrip '*/armeabi-v7a/*.so'
    }

    bundle {
        language {
            enableSplit = false
        }
        density {
            enableSplit = false
        }
        abi {
            enableSplit = true
        }
    }


    //渠道分包多维度配置
    flavorDimensions  'servertype', 'channel'
    productFlavors {
        //--------------server type--------------------
        dev {
            buildConfigField 'String', 'ServerType', '"dev_server"'
            dimension 'servertype'
        }
        publish {
            buildConfigField 'String', 'ServerType', '"public_server"'
            dimension 'servertype'
        }
        //--------------channel--------------
        oppo {

//驾驶豪车模拟器
            applicationId "com.xmhl.jshcmnq.nearme.gamecenter"
            versionName "1.0"
            manifestPlaceholders = [app_name:"驾驶豪车模拟器",app_icon:"@mipmap/icon01"]
//鲨鱼狩猎
//            applicationId "com.xmmy.sysl.nearme.gamecenter"
//            versionName "1.0"
//            manifestPlaceholders = [app_name:"鲨鱼狩猎",app_icon:"@mipmap/icon216"]
//测试
//            applicationId "com.xmhl.mnzsjkz.nearme.gamecenter"
//            versionName "1.0"
//            manifestPlaceholders = [app_name:"测试",app_icon:"@mipmap/app_icon"]
            buildConfigField 'int', 'Channel', '1'
            dimension 'channel'
        }

        vivo {
//测试
            applicationId "com.xmhl.jshcmnq.vivo"
            versionName "1.0"
            manifestPlaceholders = [app_name:"驾驶豪车模拟器",app_icon:"@mipmap/icon01"]
            buildConfigField 'int', 'Channel', '2'
            dimension 'channel'
        }

        huawei {
//测试
            applicationId "com.igame.gydd.mnsdzxc.huawei"
            versionName "1.0"
            manifestPlaceholders = [app_name:"模拟山地自行车",app_icon:"@mipmap/app_icon"]
            buildConfigField 'int', 'Channel', '3'
            dimension 'channel'
        }
    }


//    android.applicationVariants.all{
//        variant.outputs.each{ output ->
//            def outputFile = output.outputFile
//            if(variant.buildType.name.equals('release')){
//
//                def fileName = "Channel${defaultConfig.versionName}_${releaseTime()}_${variant.productFlavors[0].name}.apk"
//                output.outputFile = new File(outputFile.parent,fileName)
//            }
//        }
//    }
//
//    def  releaseTime(){
//        return new  Date().format("yyyy-MM-dd",TimeZone.getTimeZone("UTC"))
//    }


    dependencies {
        //自身基础依赖包
        implementation fileTree(dir: 'libs', include: ['*.jar','*.aar'])
        //implementation 'com.android.support:appcompat-v7:28.0.0'
        //通用sdk模块

        implementation project(path: ':ModuleBase')
        //分渠道sdk模块
        oppoImplementation project(':ModulePlatform_Oppo')
        vivoImplementation project(':ModulePlatform_Vivo')
        huaweiImplementation project(':ModulePlatform_Huawei')
    }
}

